{
  "name": "7b8aac78-5ec4-4474-9b1f-fb993ec72f93",
  "type": "Microsoft.Authorization/policyDefinitions",
  "properties": {
    "displayName": "Audit when a given service principal is not assigned to the Key Vault data plane",
    "mode": "All",
    "description": "Audit when a specified AAD object is not granted permissions to secrets, certs, or keys stored in a Key Vault through data plane access policies. This policy will not validate the permissions granted by the access policy, only the existance of at least one access policy for that object.",
    "metaData": {
      "category": "KeyVault",
      "version": "1.0.0"
    },
    "parameters": {
      "aadObjectId": {
        "type": "String",
        "metadata": {
          "displayName": "AAD Object ID",
          "description": "The objectId of the AAD user, group, or service principal to check."
        }
      },
      "effect": {
        "allowedValues": [
          "Audit",
          "Disabled"
        ],
        "defaultValue": "Audit",
        "type": "string",
        "metaData": {
          "description": "Audit or Disable the execution of the Policy",
          "displayName": "Policy effect"
        }
      }
    },
    "policyRule": {
      "if": {
        "allOf": [
          {
            "field": "type",
            "equals": "Microsoft.KeyVault/vaults"
          },
          {
            "field": "Microsoft.Keyvault/vaults/accessPolicies[*].objectId",
            "notEquals": "[parameters('aadObjectId')]"
          }
        ]
      },
      "then": {
        "effect": "[parameters('effect')]"
      }
    }
  }
}
